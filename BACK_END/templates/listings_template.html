<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listings</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Chewy&display=swap" rel="stylesheet">
    <style>
        body {
          font-family: Arial, sans-serif; /* Fallback font */
          margin: 0;
          padding: 0px;
          background-color: rgb(178, 192, 176);
      }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            padding: 10px;
        }
        .listing-item {
            background: rgb(245, 244, 227);
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
          text-align: center;
          overflow: hidden;
          transition: background-color 0.5s ease-in-out;
          transition: transform 0.5s ease-in-out;
      }
      .listing-item:hover {
          box-shadow: 0 4px 6px 0 rgb(0 0 0 / 0.1);
          background-color: rgb(178, 192, 176);
          transform: translateY(-5px);
      }
      .grid-item img {
          max-width: 100%;
          height: auto;
      }
    </style>
</head>
<body>
    <div style="background-color: rgb(245, 244, 227); height: 4rem;" class="fixed inset-x-0 top-0 flex justify-between items-center">
        <a href="https://www.google.com/" class="w-14 px-2"><img class="my-auto" src="{{ url_for('static', filename='logo.png') }}" style="width: auto; height: 50px;"></a>
        <input type="search" name="query" placeholder="Search" class="border flex-1 h-10 rounded mx-20 px-2">
        <div class="w-12 pr-2">
            <svg style="fill: rgb(178 192 176);" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <path d="M406.5 399.6C387.4 352.9 341.5 320 288 320l-64 0c-53.5 0-99.4 32.9-118.5 79.6C69.9 362.2 48 311.7 48 256C48 141.1 141.1 48 256 48s208 93.1 208 208c0 55.7-21.9 106.2-57.5 143.6zm-40.1 32.7C334.4 452.4 296.6 464 256 464s-78.4-11.6-110.5-31.7c7.3-36.7 39.7-64.3 78.5-64.3l64 0c38.8 0 71.2 27.6 78.5 64.3zM256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zm0-272a40 40 0 1 1 0-80 40 40 0 1 1 0 80zm-88-40a88 88 0 1 0 176 0 88 88 0 1 0 -176 0z"/></svg></div>
    </div>

    <div class="flex justify-center mt-16 pt-16px">
        <h1 style="color: rgb(245, 244, 227); font-family: 'Chewy', cursive; margin-top: 1rem;" class="mx-auto justify-center block text-6xl">Listing Grid</h1>
    </div>
    <!-- Dropdown for selecting categories -->
    <label for="category-select" class="p-4 pb-5px">Select a category:</label>
    <select id="category-select" onchange="fetchListings()" style="background-color: rgb(245, 244, 227);" class="mt-5 border-radius rounded-md p-2">
        <option value="">All</option>
        <option value="Product">Product</option>
        <option value="Labour">Labour</option>
        <option value="Services">Services</option>
        <option value="Transportation">Transportation</option>
        <option value="Livestock">Livestock</option>
    </select>
    
    <div class="grid-container" id="listing-grid"></div>

    <script>
        // Function to fetch listings based on selected category and render them
        function fetchListings() {
            const category = document.getElementById('category-select').value; // Get selected category
            fetch(`/listings?category=${category}`)
                .then(response => response.json())
                .then(listings => {
                    const gridContainer = document.getElementById('listing-grid');
                    gridContainer.innerHTML = ''; // Clear previous listings
                    listings.forEach(listing => {
                        // Create a grid item for each listing
                        const gridItem = document.createElement('div');
                        gridItem.className = 'listing-item';
                        gridItem.innerHTML = `
                                <img src="${listing.image_url}" alt="${listing["product name"]}">
                                <h3 class="text-2xl">${listing["product name"]}</h3>
                                <p class="text-lg">${listing.category}</p>
                                <p class="underline cursor-pointer text-md text-slate-500">${listing.location}</p>
                                <p style="display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 3; overflow: hidden; text-overflow: ellipsis;">${listing.description}</p>
                                <p class="text-slate-500 underline cursor-pointer mt-5">${listing.contact}</p>
                            </a>
                        `;
                        gridItem.onclick = () => {
                            sessionStorage.setItem("selectItem", JSON.stringify(listing));
                            window.location.href = "/productPage";
                        };
                        
                        gridContainer.appendChild(gridItem);
                    });
                })
                .catch(error => console.error('Error fetching listings:', error));
        }

        // Fetch products when the page loads
        window.onload = fetchListings;
    </script>
</body>
</html>
